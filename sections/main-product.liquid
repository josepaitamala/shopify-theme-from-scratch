{% comment %}
    templates/product.liquid
    Simple product page: image left, details right, title, price, add to cart.
    Uses placeholder content when product or images are missing.
{% endcomment %}

{{ 'section-main-product.css' | asset_url | stylesheet_tag }}

<main class="product-page" role="main">
    <div class="container container--flex-dir-row">
        <section class="product-media" aria-label="Product images">
            {% if product and product.featured_image %}
                <img
                    src="{{ product.selected_or_first_available_variant.image | default: product.featured_image | img_url: '1024x1024' }}"
                    alt="{{ product.title | escape }}"
                    class="product-image"
                >
            {% else %}
                <img src="https://placehold.co/800x800" alt="Placeholder product image">
            {% endif %}
        </section>

        <section class="product-details" aria-label="Product details">
            {%  for block in section.blocks %}
                {% case block.type %}
                    {% when 'title' %}
                        <h1 class="product-title">{{ product.title }}</h1>
                    {% when 'price' %}
                        <div class="product-price">
                            {% if product %}
                                {% assign variant = product.selected_or_first_available_variant %}
                                {% if variant and variant.price %}
                                    {{ variant.price | money }}
                                {% else %}
                                    {{ product.price | default: 0 | money }}
                                {% endif %}
                            {% endif %}
                        </div>
                    {% when 'description' %}
                        <div class="product-description">
                            {% if product and product.description != blank %}
                                {{ product.description }}
                            {% endif %}
                        </div>
                    {% when 'add_to_cart' %}
                        <product-form
                            variant-id="{{ product.selected_or_first_available_variant.id }}"
                            product-handle="{{ product.handle }}"
                        >
                            <script type="application/json" id="product-variants-json">
                                {{ product.variants | json }}
                            </script>

                            {% form 'product', product %}
                                {% if product.has_only_default_variant %}
                                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                                {% else %}
                                    <div class="product-variants">
                                        <fieldset>
                                            {% for variant in product.variants %}
                                                <label>
                                                    <input
                                                        type="radio"
                                                        name="id"
                                                        value="{{ variant.id }}"
                                                        class="product-variants__radio"
                                                        {% if variant.available == false %}disabled{% endif %}
                                                        {% if variant.id == product.selected_or_first_available_variant.id %}checked{% endif %}
                                                    />
                                                    <span class="product-variants__title">{{ variant.title }}</span>
                                                </label>
                                            {% endfor %}
                                        </fieldset>
                                    </div>
                                {% endif %}
                                
                                <label class="meta" for="quantity">Quantity</label>
                                <div class="quantity">
                                    <input id="quantity" name="quantity" type="number" min="1" value="1" inputmode="numeric" aria-label="Quantity">
                                </div>

                                {% if product.available %}
                                    <button type="submit" class="add-to-cart">Add to cart</button>
                                {% else %}
                                    <button type="button" class="add-to-cart" disabled>Sold out</button>
                                {% endif %}
                            {% endform %}
                        </product-form>
                        
                    {% when 'sku' %}
                        <div class="meta">
                            SKU: {{ product.selected_or_first_available_variant.sku | default: "N/A" }}
                        </div>
                {% endcase %}
            {% endfor %}        
        </section>
    </div>
</main>

{% schema %}
{
    "name": "Main product",
    "settings": [],
    "blocks": [
        {
            "type": "@app"
        },
        {
            "type": "title",
            "name": "Title",
        },
        {
            "type": "price",
            "name": "Price",
        },
        {
            "type": "description",
            "name": "Description",
        },
        {
            "type": "add_to_cart",
            "name": "Add to cart button",
        },
        {
            "type": "sku",
            "name": "SKU",
        }
    ],
    "presets": [
        {
            "name": "Main product",
            "category": "Products"
        }
    ]
}
{% endschema %}